(author : Fernand Veilleux)
o<taper> sub
(CALL [#start_x] [#end_x] [#start_z] [#angle] [#fine_finish])
;(print,#1, #2, #3, #4, #5)
	#<start_x>     = #1
	#<end_x>       = #2
	#<start_z>     = #3
	#<angle>       = #4
	#<fine_finish> = #5
	
	/ G0 X#<end_x> Z#<start_z>
	/ F10
	/ G1 X#<start_x> Z[#<start_z> - [[#<start_x> - #<end_x>] * TAN[90 - #<angle>]]]
	/ o<taper> return
	
	o00 if [#<_lathe_diameter_mode> EQ 1]
		#<roughcut> = [#<_rough_cut> * 2]
		#<finishcut> = [#<_finish_cut> * 2]
	o00 else
		#<roughcut> = #<_rough_cut>
		#<finishcut> = #<_finish_cut>
	o00 endif
	
	o10 if [#<fine_finish> GT 0]
		#<cut_rough_total> = [#<start_x> - #<end_x> - #<finishcut>]
	o10 else
		#<cut_rough_total> = [#<start_x> - #<end_x>]
	o10 endif
	
	F#<_rough_feed>
	#<rough_pass> = FUP[#<cut_rough_total> / #<roughcut>]
	o11 if [#<rough_pass> GT 0]
		#<each_cut> = [#<cut_rough_total> / #<rough_pass>]
	o11 elseif [#<rough_pass> LT 0]
		o<taper> return
	o11 endif
	
	G0 X[#<_wp_dia_od> + #<_X_rapid>]
	M#<_cooling_mode>
	#<x> = #<start_x>
	o12 repeat [#<rough_pass>]
		#<x> = [#<x> - #<each_cut>]
		o121 if [#<_tool_usage> LE 1]
			G0 Z#<start_z>
			G0 X#<x>
			G1 X#<start_x> Z[#<start_z> - [[#<start_x> - #<x>] * TAN[90 - #<angle>]]]
			G0 X[#<start_x> + #<_x_clear>]
		o121 endif
	o12 endrepeat
	
	o20 if [#<fine_finish> AND #<_tool_usage> NE 1]
		F#<_finish_feed>
		o21 repeat [#<fine_finish>]
			G0 Z#<start_z>
			G0 X#<end_x>
			G1 X#<start_x> Z[#<start_z> - [[#<start_x> - #<end_x>] * TAN[90 - #<angle>]]]
			G1 X[#<start_x> + #<_x_clear>]
		o21 endrepeat
	o20 endif
	
	M9 (cooling off)
	
	G0 X[#<_wp_dia_od> + #<_X_rapid>]
	
o<taper> endsub
